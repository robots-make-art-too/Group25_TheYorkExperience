<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
		<script src="https://rawcdn.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
		<script src="https://rawcdn.githack.com/wizgrav/aframe-effects/634940eb38588f20ae1be5cc572a2747723d7ad5/dist/aframe-effects.js"></script>
	</head>
	
	<body style='margin : 0px; overflow: hidden;'>

		<script type="script-effect" id="customFilter" data-defaults="tDiffuse 0.3 0.3 1." data-diffuse>
		    void $main(inout vec4 c, vec4 o, vec2 uv, float d){
		        float t = time * mix(1., 1000., abs(sin(time * 10. + uv.x)));
		        uv = vec2(uv.x + resolution.z * sin(t * c.r + c.b), uv.y - resolution.w * cos(t * c.b + c.r));
		        c.rgb += smoothstep(0.3, 0.9, texture2D($0,uv).rgb  ) * mix( $1, $2, abs(sin(time * $3))) ;
		    }
		</script>

		<script type="script-effect" id="blendOutline" data-diffuse>
		    void $main(inout vec4 c, vec4 o, vec2 uv, float d){
		        c.rgb = mix(c.rgb, o.rgb, smoothstep(0.1,0.3,o.a));
		    }
		</script>

		<script type="script-effect" id="add" data-defaults="bloom_texture bloom_intensity" data-diffuse>
		    void $main(inout vec4 c, vec4 o, vec2 uv, float d){
		        c.rgb += pow(texture2D($0, uv).rgb,vec3(2.)) * $1;
		    }
		</script>

		<a-scene
		arjs="sourceType: webcam; debugUIEnabled: false;"
		embedded
		renderer="logarithmicDepthBuffer: true;"
		vr-mode-ui="enabled: false"

    antialias="false"
    effects=" colors, outline.sobel?, #blendOutline, bloom, film,  godrays, glitch,  fxaa"
    film="sIntensity: 0.03; nIntensity: 0.2" 
    outline="enabled: false; width: 1.33 1.33; range: 0 10; strength: 3; smooth: true;" 
    colors="mode:hqprtom; mul: 0.66 0.5 0.66; pow: 1 1.33 1.66; quant: 0.3 0.3 0.1; orig: 0.33 0.66 0.66"
    bloom="filter: bloom!, bloom.filter, #customFilter(bloom_texture 0.3 0.6 0.5); strength: 0.5; radius:1.2"
    fxaa="true"
    godrays="src: #sun; threshold: 0. 0.33; intensity: 2"
    glitch="false"

		id="scene">

			<a-assets>
				<a-asset-item id="chained" src="../assets/Objects/hovercar.glb"></a-asset-item>
				<a-asset-item id="linked" src="../assets/Objects/SpaceShip.glb"></a-asset-item>
				
			</a-assets>

			<a-marker id="custom-1" type= "pattern" url="../assets/Markers/pattern-flying car.patt">
				<a-entity id="chained-gltf" position="0.5 0.5 0" scale="0.5 0.5 0.5" gltf-model="#chained"></a-entity>
			</a-marker>
			
			<a-marker id="custom-2" type= "pattern" url="../assets/Markers/pattern-spaceship.patt">
				<a-entity id="linked-gltf" position="0.5 0.5 0" scale="0.5 0.5 0.5" gltf-model="#linked"></a-entity>
			</a-marker>
		
		</a-scene>

		<div style="position:fixed; top:0; left:0; width: 100%; z-index:1000; text-align: center">
		    <label style="font-weight: bold; color: white; text-shadow: 1px 1px black; cursor: pointer;">
		        <input type="checkbox" checked style="vertical-align: bottom;"
		            onchange="document.querySelector('a-scene').setAttribute('effects', this.checked ? 'colors, outline.sobel?, #blendOutline, bloom, film,  godrays, glitch,  fxaa' : ''  )" />
		        Toggle effects
		    </label>
		    <label style="font-weight: bold; color: white; text-shadow: 1px 1px black; cursor: pointer;">
		        <input type="checkbox" style="vertical-align: bottom;"
		            onchange="document.querySelector('a-scene').setAttribute('glitch', this.checked  )" />
		        Glitch
		    </label>
		    <label style="font-weight: bold; color: white; text-shadow: 1px 1px black; cursor: pointer;">
		        <input type="checkbox" checked style="vertical-align: bottom;"
		            onchange="document.querySelector('a-scene').setAttribute('fxaa', this.checked  )" />
		        FXAA
		    </label>
		</div>

	
	</body>
</htlm>
